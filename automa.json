{
	"info": {
		"_postman_id": "232dbd91-a584-4fce-ab52-c528b48701bb",
		"name": "Automatizacion",
		"description": "Openfactura utiliza una API RESTful basada en HTTP. Las peticiones y respuestas de la API se hacen por medio del uso de mensajes formateados en JSON.\n\n\n> ℹ️ Openfactura ofrece un entorno de desarrollo completamente operativo para que los desarrolladores e interesados puedan integrar sus aplicaciones y sistemas.\n\n# Comunidad\n\nDisponemos de un canal en Slack en el cual pueden participar, ya sea para realizar consultas y/o comentarios que tengas sobre la integración.\n\n> [https://haulmer.slack.com](https://communityinviter.com/apps/haulmer/haulmer)\n\n\n# Autorización y Autenticación\n\nTodas las peticiones que se realizan a la API de Openfactura deben contener en la cabecera la credencial _API Key_, la cual es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\nLas _API Keys_ generadas por el sistema están siempre asociadas a un usuario-empresa. Por lo que todas las consultas realizadas a través de la API con una _API Key_ estarán ligadas a las acciones del \"dueño\" de la empresa.\n\n# Seguridad\n\nSe debe tener en consideración los límites que ofrece la API para su implementación, actualmente se tiene un límite de peticiones por segundos y minutos que se pueden realizar.\n\n+ límite de consultas por segundos: 3\n+ límite de consultas por minutos: 100\n\nCuando se alcance alguno de estos límites el sistema reponderá con un código HTTP de error 429 y el mensaje:\n\n```json\n{ \"statusCode\": 429, \"message\": \"Rate limit is exceeded. Try again in X seconds.\" }\n```\n\n# Solicitud API Key\n\nOpenfactura dispone de dos _API Key_ públicas para facilitar y agilizar la integración con la API (la cual puedes encontrar más abajo en está misma documentación), además se deja a disposición la interfaz web de [Openfactura DEV](https://learn-openfactura.haulmer.com) para estas dos  _API Key_, de esta forma poder analizar y entender de mejor manera que ocurre en cada emisión de los diferentes DTE que realices.\n\nCuando exista un error de validación de _API Key_ el sistema reponderá con un código HTTP de error 401 y el mensaje:\n\n```json\n{ \"statusCode\": 401, \"message\": \"Access denied due to invalid subscription key. Make sure to provide a valid key for an active subscription.\" }\n```\n\n# URLs\n Existen dos URL para las APIs, una para cada ambiente: \n \n + Producción: `https://api.haulmer.com`\n + Desarrollo: `https://dev-api.haulmer.com`\n\n\n\n***\n\n# APIs REST",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "13259060",
		"_collection_link": "https://restless-firefly-1360-1.postman.co/workspace/QA---Automatizaci%C3%B3n---TN~5268c47c-17b3-4497-8bf6-58f239819a5b/collection/13259060-232dbd91-a584-4fce-ab52-c528b48701bb?action=share&source=collection_link&creator=13259060"
	},
	"item": [
		{
			"name": "TOTALES",
			"item": [
				{
					"name": "Descuento/Recargo Global",
					"item": [
						{
							"name": "Descuento Porcentaje",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":2640,\"TasaIVA\":\"19\",\"IVA\":502,\"MntTotal\":3142,\"MontoPeriodo\":3142,\"VlrPagar\":3142}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":2000,\"MontoItem\":2000},{\"NroLinDet\":2,\"NmbItem\":\"item 2\",\"QtyItem\":1,\"PrcItem\":1000,\"MontoItem\":1000}],\"DscRcgGlobal\":[{\"NroLinDR\":1,\"TpoMov\":\"D\",\"TpoValor\":\"%\",\"ValorDR\":\"12\"}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						},
						{
							"name": "Descuento Monto",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":1900,\"TasaIVA\":\"19\",\"IVA\":361,\"MntTotal\":2261,\"MontoPeriodo\":2261,\"VlrPagar\":2261}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":2000,\"MontoItem\":2000}],\"DscRcgGlobal\":[{\"NroLinDR\":1,\"TpoMov\":\"D\",\"TpoValor\":\"$\",\"ValorDR\":\"100\"}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						},
						{
							"name": "Recargo Porcentaje",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":3300,\"TasaIVA\":\"19\",\"IVA\":627,\"MntTotal\":3927,\"MontoPeriodo\":3927,\"VlrPagar\":3927}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":2000,\"MontoItem\":2000},{\"NroLinDet\":2,\"NmbItem\":\"item 2\",\"QtyItem\":1,\"PrcItem\":1000,\"MontoItem\":1000}],\"DscRcgGlobal\":[{\"NroLinDR\":1,\"TpoMov\":\"R\",\"TpoValor\":\"%\",\"ValorDR\":\"10\"}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						},
						{
							"name": "Recargo Monto",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dq",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":3300,\"TasaIVA\":\"19\",\"IVA\":627,\"MntTotal\":3927,\"MontoPeriodo\":3927,\"VlrPagar\":3927}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":2000,\"MontoItem\":2000},{\"NroLinDet\":2,\"NmbItem\":\"item 2\",\"QtyItem\":1,\"PrcItem\":1000,\"MontoItem\":1000}],\"DscRcgGlobal\":[{\"NroLinDR\":1,\"TpoMov\":\"R\",\"TpoValor\":\"$\",\"ValorDR\":\"300\"}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						}
					]
				},
				{
					"name": "Credito empresas constructoras",
					"item": [
						{
							"name": "65% IVA",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":80000000,\"TasaIVA\":\"19\",\"IVA\":15200000,\"MntTotal\":85320000,\"CredEC\":9880000,\"MontoPeriodo\":85320000,\"VlrPagar\":85320000}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":80000000,\"MontoItem\":80000000}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						},
						{
							"name": "Menos 65% IVA",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":80000000,\"TasaIVA\":\"19\",\"IVA\":15200000,\"MntTotal\":89700000,\"CredEC\":5500000,\"MontoPeriodo\":89700000,\"VlrPagar\":89700000}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":80000000,\"MontoItem\":80000000}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						},
						{
							"name": "Saldo anterior",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"a= new Date ()",
											"var month = a.getMonth() + 1;",
											"var day = a.getDate();",
											"if (month < 10) month = '0' + month;",
											"if (day < 10) day = '0' + day;",
											"postman.setGlobalVariable(\"DateToday\", a.getFullYear() + \"-\" + month +  \"-\" + day);",
											"",
											"const idempotencyKey = Math.random().toString(36).substring(2, 15) +",
											"  Math.random().toString(36).substring(2, 15);",
											"",
											"pm.environment.set(\"idempotencyKey\", idempotencyKey);",
											"",
											"pm.request.headers.add({",
											"    key: 'Idempotency-Key',",
											"    value: idempotencyKey",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Response code 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"pm.test(\"Content-Type should be JSON\", function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json');",
											"});",
											"pm.test(\"Response time is less than 10s\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(30000);",
											"});",
											"pm.test(\"Correct response\", () => {",
											"    const responseData = pm.response.json();",
											"    pm.expect(responseData).to.have.property('TOKEN').that.is.a('string');",
											"    pm.expect(responseData).to.have.property('FOLIO').that.is.a('number');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "apikey",
										"value": "928e15a2d14d4a6292345f04960f4bd3"
									},
									{
										"key": "Idempotency-Key",
										"value": "fccb60fb512d13df5083790d64c4d5dd",
										"disabled": true
									},
									{
										"key": "Content-type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"response\":[\"FOLIO\"],\"dte\":{\"Encabezado\":{\"IdDoc\":{\"TipoDTE\":33,\"Folio\":0,\"FchEmis\":\"2023-10-23\",\"TpoTranCompra\":\"1\",\"TpoTranVenta\":\"1\",\"FmaPago\":\"2\"},\"Emisor\":{\"RUTEmisor\":\"76795561-8\",\"RznSoc\":\"HAULMER SPA\",\"GiroEmis\":\"VENTA AL POR MENOR POR CORREO, POR INTERNET Y VIA TELEFONICA\",\"Acteco\":\"479100\",\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\"CmnaOrigen\":\"Curicó\",\"Telefono\":\"0 0\",\"CdgSIISucur\":\"81303347\"},\"Receptor\":{\"RUTRecep\":\"76430498-5\",\"RznSocRecep\":\"HOSTY SPA\",\"GiroRecep\":\"ACTIVIDADES DE CONSULTORIA DE INFORMATIC\",\"DirRecep\":\"ARTURO PRAT 527 3 pis OF 1\",\"CmnaRecep\":\"Curicó\"},\"Totales\":{\"MntNeto\":80000000,\"TasaIVA\":\"19\",\"IVA\":15200000,\"MntTotal\":89700000,\"CredEC\":5500000,\"MontoPeriodo\":89700000,\"SaldoAnterior\":2000000,\"VlrPagar\":91700000}},\"Detalle\":[{\"NroLinDet\":1,\"NmbItem\":\"item 1\",\"QtyItem\":1,\"PrcItem\":80000000,\"MontoItem\":80000000}]}}"
								},
								"url": {
									"raw": "{{url-api-dev}}/v2/dte/document",
									"host": [
										"{{url-api-dev}}"
									],
									"path": [
										"v2",
										"dte",
										"document"
									]
								},
								"description": "Las validaciones realizadas por esta API corresponden a las mismas presentadas por el Servicio de Impuestos Internos (SII). Con el fin de mantener una compatibilidad, facilitar el entendimiento y futuras correcciones que el SII pueda realizar, se mantienen los mismos nombres (sensible a mayúsculas) que utiliza el SII en su [formato de documentos electrónicos](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf). Openfactura implementa cada uno de estos campos existentes para los DTE soportados (más información [openfactura.cl](https://www.openfactura.cl)).\n\nPara las pruebas en el ambiente de desarrollo se han dispuesto de dos empresas y cada una con su respectiva _API Key_. Además se adjunta información necesaria que debe enviarse en la sección Emisor durante cada emisión de DTE.\n\n## Haulmer\n\n```json\n{\n\t\"apikey\": \"928e15a2d14d4a6292345f04960f4bd3\",\n\t\"RUTEmisor\":\"76795561-8\",\n\t\"RznSoc\":\"HAULMER SPA\",\n\t\"GiroEmis\":\"VENTA AL POR MENOR EN EMPRESAS DE VENTA A DISTANCIA VÍA INTERNET; COMERCIO ELEC\",\n\t\"Acteco\":479100,\n\t\"DirOrigen\":\"ARTURO PRAT 527   CURICO\",\n\t\"CmnaOrigen\":\"Curicó\",\n\t\"CdgSIISucur\":\"81303347\"\n}\n```\n\n## Hosty\n\n```json\n{\n\t\"apikey\": \"41eb78998d444dbaa4922c410ef14057\",\n\t\"RUTEmisor\":\"76430498-5\",\n    \"RznSoc\":\"HOSTY SPA\",\n    \"GiroEmis\":\"EMPRESAS DE SERVICIOS INTEGRALES DE INFORMÁTICA\",\n    \"Acteco\":620200,\n    \"DirOrigen\":\"ARTURO PRAT 527 3 pis OF 1\",\n    \"CmnaOrigen\":\"Curicó\",\n    \"CdgSIISucur\":\"79457965\"\n}\n```\n\n<br>\n\n> ℹ️ Todas las emisiones realizadas en el ambiente de desarrollo, estarán disponible en el sitio  [Openfactura Dev](https://learn-openfactura.haulmer.com/dte/emitidos).\n\n\n## Ejemplos de Documentos \n\nSe han realizado varios ejemplos de distintos DTE. Estos se encuentran en esta misma página al lado derecho.\n\n<img src=\"https://image.ibb.co/nwyXkK/Captura_de_pantalla_2018_09_06_a_la_s_11_48_06.png\" alt=\"example_document\" border=\"10\">\n\n<br> \n\nTambién es posible cambiar el lenguaje de ese ejemplo, la opción se encuentra al inicio de la página al lado derecho.\n\n> ℹ️ Si selecciona jQuery debe ser una version igual o superior a 1.9 .\n\n\n<br>\n\n\nA continuación se detalla el formato del mensaje JSON que se debe enviar en el cuerpo de la petición HTTP para generar documentos electrónicos en la plataforma de facturación electrónica Openfactura.\n\nCabe destacar que solo se presenta un subconjunto de los campos existentes ([lista completa de campos disponibles](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf)), siendo estos los más comunes:\n\n## Headers\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| apikey | * | string |\n| Idempotency-Key |  | string |\n\n## Body\n\n| Campo  | Requerido | Tipo |\n| --- | --- | --- |\n| dte | * | object |\n| response |  | array |\n| custom |  | object |\n\n\n## Descripción Campos Cabecera (`Headers`) HTTP\n\n### API Key\nLa `apikey` es utilizada para verificar los permisos sobre el _endpoint_ que intenta acceder, además de identificar quién es el que realiza la petición sobre el sistema.\n\n### Idempotency Key\nLas emisiones en Openfactura tiene soporte para idempotencia, esto quiere decir que permitirá el reenvío seguro de peticiones sin realizar accidentalmente la misma emisión dos veces. La llave (_Idempotency Key_) debe ser única y generadas por el cliente, las cuales tienen una duración de 24 horas, si dentro de ese mismo tiempo se envía la misma _key_ se obtendrá un error de validación de _Idempotency Key_.\n<br>\n<br>\nAdemás cuando se genere un error de _Idempotency Key_ la API devolverá el _token_ que le fue asignado a ese documento.\n<br>\n<br>\nLa principal ventaja que proporciona esta característica es: ante algún fallo en la transmisión, recepción y/o tratamiento en la respuesta, se puede reintentar de forma segura (dentro de 24 horas) ya que siempre se emitirá una sola vez.\n\n## Descripción Campos Cuerpo (`Body`) HTTP\n\n### `response`\n\nCorresponde a las respuestas que desea recibir luego de una emisión exitosa. `response` es un arreglo con todas sus variables en mayúsculas, si no se envía se devolverá solamente un _token_ que es la respuesta por defecto.\n\n#### Estructura\n\n| Nodo Padre | Campo  | Req. | Tipo \n| --- | --- | :---: | --- |\n| response | XML |  | string | \n| response | PDF |  | string | \n| response | TIMBRE |  | string | \n| response | LOGO |  | string | \n| response | FOLIO |  | string | \n| response | RESOLUCION |  | string |\n| response | LETTER |  | string |\n| response | 80MM |  | string |\n| response | 80MMNOLOGO |  | string |\n\n```json\n{\n  \"response\": [\"XML\", \"PDF\", \"TIMBRE\", \"LOGO\", \"FOLIO\", \"RESOLUCION\", \"80MM\"],\n}\n```\n\n#### XML\nEs el documento generado para la emision y enviado al SII. Este XML se devuelve en la respuesta codificado en Base64.\n> ⚠️ Al decodificar tener en cosideración que el XML esta en la norma **ISO 8859-1**. \n\n#### PDF\nSe refiere a la generación del documento emitido en PDF con la plantilla de OpenFactura y codificado en Base64. Para el Servicio de Impuesto Internos solo es posible generar un documento con un largo máximo de 1 página, cabe destacar que esta restricción solo aplica para formato carta (`LETTER`).\n> ⚠️ Si no desea esta funcionalidad puede generar su propio PDF y ser responsable de cumplir con los requisitos que exige el SII.\n\n#### TIMBRE\nCorresponde a la imagen del timbre generado al emitir el documento, esta imagen esta en formato png y codificado en Base64.\n\n#### LOGO\nEs el logo de la empresa registrada en OpenFactura, la imagen esta en formato png y codificado en Base64.\n\n#### FOLIO\nSe retornará el folio utilizada para la emisión\n\n#### RESOLUCION\nSe entrega en la respuesta la fecha y número de resolución del tipo de documento emitido. Útil para generar la representación en PDF.\n\n#### 80MM y LETTER\nSon los formatos disponibles para la generación de PDF, por defecto siempre se asume tamaño carta (`LETTER`).\n\n#### 80MMNOLOGO\nEs el formato de 80mm para la generación del PDF pero sin el logo de la empresa.\n\n### dte\n\nEl objeto _dte_ debe contener todos los campos relacionados con el DTE que se desea emitir. Se encuentra basado en la nomenclatura del SII.\nEl orden de las secciones (`Encabezado`, `Detalle`, `DscRcgGlobal`, etc) que presenta la estructura interna del objeto _dte_ debe ser de la forma que se detalla a continuación, respetando siempre su obligatoriedad. Cabe destacar que la exigencia de los campos puede variar dependiendo del tipo de DTE que se desea enviar (ver [formato de documentos electrónicos del SII](http://www.sii.cl/factura_electronica/factura_mercado/formato_dte.pdf), ver [formato boletas electrónicas del SII](http://www.sii.cl/factura_electronica/factura_mercado/boletas_elec_020.pdf)).\n\n\n\n> ℹ️ Para verificar el formato del json a enviar puede utilizar esta [pagina](https://jsonformatter.curiousconcept.com/).\n\n\n\n#### Estructura\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| dte | Encabezado | * | object |\n| dte | Detalle | * | array |\n| dte | DscRcgGlobal |  | array |\n| dte | Referencia | | array |\n| dte | Comisiones | | array |\n\n#### Encabezado\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| Encabezado | IdDoc | * | object |\n| Encabezado | Emisor | * | object |\n| Encabezado | RUTMandante | | string |\n| Encabezado | Receptor | * | object |\n| Encabezado | RUTSolicita | | string |\n| Encabezado | Transporte | | object |\n| Encabezado | Totales | * | object |\n\n#### IdDoc\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| IdDoc | TipoDTE | * | int | |\n| IdDoc | Folio | * | int | debe ser 0 |\n| IdDoc | FchEmis | * | string | AAAA-MM-DD |\n| IdDoc | TpoTranCompra | | int | |\n| IdDoc | TpoTranVenta | | int | |\n| IdDoc | FmaPago | | int | . |\n\n#### Emisor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Emisor | RUTEmisor | * | string | |\n| Emisor | RznSoc | * | string | |\n| Emisor | GiroEmis | * | string | |\n| Emisor | CorreoEmisor | | string | |\n| Emisor | Acteco | * | int | |\n| Emisor | DirOrigen | * | string | |\n| Emisor | CmnaOrigen | * | string | . |\n\n#### Receptor\n\n| Nodo Padre | Campo | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Receptor | RUTRecep | * | string | |\n| Receptor | RznSocRecep | * | string | |\n| Receptor | GiroRecep | * | string | |\n| Receptor | Contacto | * | string | |\n| Receptor | DirRecep | * | string | |\n| Receptor | CmnaRecep | * | string | . |\n\n\n#### Detalle\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Detalle | NroLinDet | * | int | Número secuencial de la línea |\n| Detalle | NmbItem | * | string | |\n| Detalle | DscItem |  | string | |\n| Detalle | QtyItem | * | float | máx 6 decimales|\n| Detalle | PrcItem | * | float | máx 6 decimales|\n| Detalle | MontoItem | * | int | |\n| Detalle | IndExe |  | int | Si el producto es exento o no afecto |\n\n\n#### DscRcgGlobal (Opcional)\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| DscRcgGlobal | NroLinDR | * | int | Número secuencial de la línea |\n| DscRcgGlobal | TpoMov | * | string | D(descuento) o R(recargo) |\n| DscRcgGlobal | GlosaDR |  | string | |\n| DscRcgGlobal | TpoValor | * | string | “%” o “$”| \n| DscRcgGlobal | ValorDR | * | int | |\n| DscRcgGlobal | IndExeDR |  | int | 1 (No afecto o exento) o 2(No facturable) |\n\n#### Totales\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| Totales | MntNeto |  | int | |\n| Totales | MntExe |  | int | |\n| Totales | IVA |  | int | |\n| Totales | MntTotal | * | int | |\n| Totales | MntNF |  | int | |\n| Totales | SaldoAnterior |  | int | |\n| Totales | VlrPagar |  | int | |\n\n## Campos personalizados\nSe pueden agregar dos campos opcionales para personalizar la emisión de un documento, estos campos son _informationNote_ y _paymentNote_ los cuales se verán reflejados en el PDF de dicho documento. Para hacer visible estos campos solo se deben agregar a la raíz del JSON en el objeto _custom_.\n\n#### custom\n\n| Nodo Padre | Campo | Req. | Tipo |\n| --- | --- | :---: | --- |\n| custom | informationNote |  | string |\n| custom | paymentNote |  | string |\n\n\n## Sobre la respuesta\n\nExisten dos tipos de respuestas; la emisión exitosa donde el documento fue emitido correctamente y la emisión fallida donde existen errores en el _dte_ enviado.<br> \nEn todas las respuestas validadas correctamente por Openfactura, se incorpora el campo _TOKEN_ que es de utilidad para realizar seguimiento al _dte_ generado. Exepcionalmente se podría devolver el campo _WARNING_ que indica la existencia algunos reparos que no impiden la emisión del documento pero se suguiere que para siguientes emisiones lo solucionen.\nPara el caso contrario de que tenga errores el _dte_ se indicará cual fue este error mediante un código y una descripción (se detalla en la siguiente sección).\n\n### Respuesta\n\n| Campo | Opcional |Tipo | Desc.\n| --- | --- | --- | --- |\n| TOKEN | | string | Token de seguimiento |\n| WARNING | * | string | Reparos en el envio |\n| XML | * | string | XML en base64 con codificación 8859-1. (considerar al decodificar) |\n| PDF | * | string | Representación en base64 del PDF.  |\n| TIMBRE | * | string | Imagen en formato png en base64. |\n| LOGO | * | string | Imagen en formato png en base64. |\n| FOLIO | * | int | Folio asignado por el SII. |\n| RESOLUCION | * | object | Fecha y número de resolución. |\n\n\n```json\n{\n   \"TOKEN\": \"string\",\n   \"FOLIO\": int,\n   \"RESOLUCION\": {\n        \"fecha\": \"string\",\n        \"numero\": int\n    },\n    \"TIMBRE\": \"string\",\n    \"XML\": \"string\",\n    \"LOGO\": \"string\", \n    \"PDF\": \"string\",\n}\n```\n\n### Errores\nCuando el documento enviado (`dte`) presenta errores, estos pueden ser por diferentes causas que serán descritas en la respuesta mediante un código y una descripción. Si es propicio se indicaró en que campos se produjo el error con un detalle del error para cada campo.\n<br>\nA continuación se detallan los diferentes tipos de códigos de error:\n\n| Código | Desc.\n| --- | --- |\n| OF-01 | Faltan datos obligatorios.|\n| OF-02 | Faltan campos obligatorios en el _dte_.|\n| OF-03 | Validación de Permisos.|\n| OF-04 | Validación de Firma electrónica.|\n| OF-05 | Tipo Dte no soportado.|\n| OF-06 | Validación Idempotencia.|\n| OF-07 | Validación de Folios.|\n| OF-08 | Validación de Esquema.|\n| OF-09 | Validación de Relaciones.|\n| OF-10 | Validación de Campos.|\n| OF-11 | Validación de PDF.|\n| OF-12 | Generación XML.|\n| OF-13 | Error en DB.|\n| OF-20 | Datos de entrada incorrectos.|\n| OF-21 | Base de datos no disponible intente más tarde.|\n| OF-22 | Problema al procesar los datos.|\n| OF-23 | DTE no soportado. Se bloquea envio de RVD(ex RCOF) y la emisión de boletas, ya sea por que el usuario se encuentra emitiendo con el SII, el usuario solicito la baja o se esta corrigiendo el folio siguiente del DTE (bloqueo temporal).|\n\n#### Respuesta de Error\n\n| Nodo Padre | Campo  | Req. | Tipo | Regla\n| --- | --- | :---: | --- | --- |\n| error | message | * | string | Descripción del error. |\n| error | code | * | string | Código asignado al error. |\n| error | details |  | arreglo(objetos) | Arreglo con los errores. |\n\n\n\n```\n{ \n  \"error\": {\n    \"message\": string,\n    \"code\": \"OF-01\",\n    \"details\": array\n  }\n}\n```\n\n| Nodo Padre | Campo | Tipo | Regla\n| --- | --- | :---: | --- |\n| details | field | string | Campo del error. |\n| details | issue | string | Detalle del error. | \n\n```\n{ \n  \"details\": [\n    { \"field\": string, \"issue\": string },\n    { \"field\": string, \"issue\": string }\n    ]\n}\n```"
							},
							"response": []
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}